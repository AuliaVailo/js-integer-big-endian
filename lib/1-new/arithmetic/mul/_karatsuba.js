"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._karatsuba = _karatsuba;
/**
 *
 * Multiply two big endian arrays using karatsuba algorithm,
 * |A| >= |B| > 0, |C| >= 2 * |A|, |A| > 1.
 *
 * /!\ BLOCK MULTIPLICATION RESULT MUST HOLD IN THE JAVASCRIPT NUMBER TYPE
 *     (DOUBLE i.e. 53 bits)
 *
 * EXPLANATION
 * ###########
 *
 * We consider the numbers a and b, both of size N = 2n.
 *
 * We divide a and b into their lower and upper parts.
 *
 * a = a1 r^{n} + a0 (1)
 * b = b1 r^{n} + b0 (2)
 *
 * We express the product of a and b using their lower and upper parts.
 *
 * a b = (a1 r^{n} + a0) (b1 r^{n} + b0) (3)
 *     = a1 b1 r^{2n} + (a1 b0 + a0 b1) r^{n} + a0 b0 (4)
 *
 * This gives us 4 multiplications with operands of size n.
 * Using a simple trick, we can reduce this computation to 3 multiplications.
 *
 * We give the 3 terms of (4) the names z0, z1 and z2.
 *
 * z2 = a1 b1
 * z1 = a1 b0 + a0 b1
 * z0 = a0 b0
 *
 * a b  = z2 r^{2n} + z1 r^{n} + z0
 *
 * We then express z1 using z0, z2 and one additional multiplication.
 *
 * (a1 + a0)(b1 + b0) = a1 b1 + a0 b0 + (a1 b0 + a0 b1)
 *                    = z2 + z0 + z1
 *
 * z1 = (a1 + a0)(b1 + b0) - z2 - z0
 *
 * AN ANOTHER WAY AROUND (not used here)
 *
 * (a1 - a0)(b1 - b0) = (a1 b1 + a0 b0) - (a1 b0 + a0 b1)
 * (a0 - a1)(b1 - b0) = (a1 b0 + a0 b1) - (a1 b1 + a0 b0)
 * a b = (r^{2n} + r^{n})a1 b1 + r^{n}(a0 - a1)(b1 - b0) + (r^{n} + 1)a0 b0
 *
 * This algorithm is a specific case of the Toom-Cook algorithm, when m = n =
 * 2.
 *
 * For further reference, see
 *  - http://en.wikipedia.org/wiki/Karatsuba_algorithm
 *  - http://en.wikipedia.org/wiki/Toomâ€“Cook_multiplication
 *
 * @param {Number} r base (radix)
 * @param {Array} a first operand
 * @param {Number} ai a left
 * @param {Number} aj a right
 * @param {Array} b second operand
 * @param {Number} bi b left
 * @param {Number} bj b right
 * @param {Array} c result, must be 0 initialized
 * @param {Number} ci c left
 * @param {Number} cj c right
 */

function _karatsuba(r, a, ai, aj, b, bi, bj, c, ci, cj) {

  var i = aj - ai;
  var j = bj - bi;
  var k = cj - ci;

  var n = Math.ceil(i / 2);
  var I = i + j;
  var N = 2 * n;
  var N_ = I - N;
  var i_ = aj - n;
  var j_ = Math.max(bi, bj - n);

  var t1 = _zeros(n + 1); // + 1 to handle addition overflows
  var t2 = _zeros(n + 1); // and guarantee reducing k for the
  var t3 = _zeros(N + 1); // recursive calls
  var z2 = _zeros(N_);
  var z0 = _zeros(N);

  // RECURSIVE CALLS
  _mul(r, a, ai, i_, b, bi, j_, z2, 0, N_); // z2 = a1.b1
  _mul(r, a, i_, aj, b, j_, bj, z0, 0, N); // z0 = a0.b0
  _add(r, a, ai, i_, a, i_, aj, t1, 0, n + 1); // (a0 + a1)
  _add(r, b, bi, j_, b, j_, bj, t2, 0, n + 1); // (b1 + b0)
  _mul(r, t1, 1, n + 1, t2, 1, n + 1, t3, 1, N + 1); // (a0 + a1)(b1 + b0)

  // BUILD OUTPUT
  _copy(z2, 0, N_, c, cj - I); // + z2 . r^{2n}
  _copy(z0, 0, N, c, cj - N); // + z0

  // overflow on t1, add t2 . r^{n}
  if (t1[0]) _iadd(r, t3, 0, n + 1, t2, 0, n + 1);

  // overflow on t2, add t1 . r^{n} (except t1[0])
  if (t2[0]) _iadd(r, t3, 0, n + 1, t1, 1, n + 1);

  _iadd(r, c, ci, cj - n, t3, 0, N + 1); // + (a0 + a1)(b1 + b0) . r^{n}
  _isub(r, c, ci, cj - n, z2, 0, N_); // - z2 . r^{n}
  _isub(r, c, ci, cj - n, z0, 0, N); // - z1 . r^{n}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy8xLW5ldy9hcml0aG1ldGljL211bC9fa2FyYXRzdWJhLmpzIl0sIm5hbWVzIjpbIl9rYXJhdHN1YmEiLCJyIiwiYSIsImFpIiwiYWoiLCJiIiwiYmkiLCJiaiIsImMiLCJjaSIsImNqIiwiaSIsImoiLCJrIiwibiIsIk1hdGgiLCJjZWlsIiwiSSIsIk4iLCJOXyIsImlfIiwial8iLCJtYXgiLCJ0MSIsIl96ZXJvcyIsInQyIiwidDMiLCJ6MiIsInowIiwiX211bCIsIl9hZGQiLCJfY29weSIsIl9pYWRkIiwiX2lzdWIiXSwibWFwcGluZ3MiOiI7Ozs7O1FBa0VnQkEsVSxHQUFBQSxVO0FBbEVoQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0VPLFNBQVNBLFVBQVQsQ0FBc0JDLENBQXRCLEVBQTBCQyxDQUExQixFQUE4QkMsRUFBOUIsRUFBbUNDLEVBQW5DLEVBQXdDQyxDQUF4QyxFQUE0Q0MsRUFBNUMsRUFBaURDLEVBQWpELEVBQXNEQyxDQUF0RCxFQUEwREMsRUFBMUQsRUFBK0RDLEVBQS9ELEVBQW9FOztBQUUxRSxNQUFNQyxJQUFJUCxLQUFLRCxFQUFmO0FBQ0EsTUFBTVMsSUFBSUwsS0FBS0QsRUFBZjtBQUNBLE1BQU1PLElBQUlILEtBQUtELEVBQWY7O0FBRUEsTUFBTUssSUFBS0MsS0FBS0MsSUFBTCxDQUFXTCxJQUFJLENBQWYsQ0FBWDtBQUNBLE1BQU1NLElBQUtOLElBQUlDLENBQWY7QUFDQSxNQUFNTSxJQUFLLElBQUlKLENBQWY7QUFDQSxNQUFNSyxLQUFLRixJQUFJQyxDQUFmO0FBQ0EsTUFBTUUsS0FBS2hCLEtBQUtVLENBQWhCO0FBQ0EsTUFBTU8sS0FBS04sS0FBS08sR0FBTCxDQUFVaEIsRUFBVixFQUFlQyxLQUFLTyxDQUFwQixDQUFYOztBQUVBLE1BQU1TLEtBQUtDLE9BQVFWLElBQUksQ0FBWixDQUFYLENBYjBFLENBYTdD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YmlnIGVuZGlhbiBhcnJheXMgdXNpbmcga2FyYXRzdWJhIGFsZ29yaXRobSxcbiAqIHxBfCA+PSB8QnwgPiAwLCB8Q3wgPj0gMiAqIHxBfCwgfEF8ID4gMS5cbiAqXG4gKiAvIVxcIEJMT0NLIE1VTFRJUExJQ0FUSU9OIFJFU1VMVCBNVVNUIEhPTEQgSU4gVEhFIEpBVkFTQ1JJUFQgTlVNQkVSIFRZUEVcbiAqICAgICAoRE9VQkxFIGkuZS4gNTMgYml0cylcbiAqXG4gKiBFWFBMQU5BVElPTlxuICogIyMjIyMjIyMjIyNcbiAqXG4gKiBXZSBjb25zaWRlciB0aGUgbnVtYmVycyBhIGFuZCBiLCBib3RoIG9mIHNpemUgTiA9IDJuLlxuICpcbiAqIFdlIGRpdmlkZSBhIGFuZCBiIGludG8gdGhlaXIgbG93ZXIgYW5kIHVwcGVyIHBhcnRzLlxuICpcbiAqIGEgPSBhMSByXntufSArIGEwICgxKVxuICogYiA9IGIxIHJee259ICsgYjAgKDIpXG4gKlxuICogV2UgZXhwcmVzcyB0aGUgcHJvZHVjdCBvZiBhIGFuZCBiIHVzaW5nIHRoZWlyIGxvd2VyIGFuZCB1cHBlciBwYXJ0cy5cbiAqXG4gKiBhIGIgPSAoYTEgcl57bn0gKyBhMCkgKGIxIHJee259ICsgYjApICgzKVxuICogICAgID0gYTEgYjEgcl57Mm59ICsgKGExIGIwICsgYTAgYjEpIHJee259ICsgYTAgYjAgKDQpXG4gKlxuICogVGhpcyBnaXZlcyB1cyA0IG11bHRpcGxpY2F0aW9ucyB3aXRoIG9wZXJhbmRzIG9mIHNpemUgbi5cbiAqIFVzaW5nIGEgc2ltcGxlIHRyaWNrLCB3ZSBjYW4gcmVkdWNlIHRoaXMgY29tcHV0YXRpb24gdG8gMyBtdWx0aXBsaWNhdGlvbnMuXG4gKlxuICogV2UgZ2l2ZSB0aGUgMyB0ZXJtcyBvZiAoNCkgdGhlIG5hbWVzIHowLCB6MSBhbmQgejIuXG4gKlxuICogejIgPSBhMSBiMVxuICogejEgPSBhMSBiMCArIGEwIGIxXG4gKiB6MCA9IGEwIGIwXG4gKlxuICogYSBiICA9IHoyIHJeezJufSArIHoxIHJee259ICsgejBcbiAqXG4gKiBXZSB0aGVuIGV4cHJlc3MgejEgdXNpbmcgejAsIHoyIGFuZCBvbmUgYWRkaXRpb25hbCBtdWx0aXBsaWNhdGlvbi5cbiAqXG4gKiAoYTEgKyBhMCkoYjEgKyBiMCkgPSBhMSBiMSArIGEwIGIwICsgKGExIGIwICsgYTAgYjEpXG4gKiAgICAgICAgICAgICAgICAgICAgPSB6MiArIHowICsgejFcbiAqXG4gKiB6MSA9IChhMSArIGEwKShiMSArIGIwKSAtIHoyIC0gejBcbiAqXG4gKiBBTiBBTk9USEVSIFdBWSBBUk9VTkQgKG5vdCB1c2VkIGhlcmUpXG4gKlxuICogKGExIC0gYTApKGIxIC0gYjApID0gKGExIGIxICsgYTAgYjApIC0gKGExIGIwICsgYTAgYjEpXG4gKiAoYTAgLSBhMSkoYjEgLSBiMCkgPSAoYTEgYjAgKyBhMCBiMSkgLSAoYTEgYjEgKyBhMCBiMClcbiAqIGEgYiA9IChyXnsybn0gKyByXntufSlhMSBiMSArIHJee259KGEwIC0gYTEpKGIxIC0gYjApICsgKHJee259ICsgMSlhMCBiMFxuICpcbiAqIFRoaXMgYWxnb3JpdGhtIGlzIGEgc3BlY2lmaWMgY2FzZSBvZiB0aGUgVG9vbS1Db29rIGFsZ29yaXRobSwgd2hlbiBtID0gbiA9XG4gKiAyLlxuICpcbiAqIEZvciBmdXJ0aGVyIHJlZmVyZW5jZSwgc2VlXG4gKiAgLSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0thcmF0c3ViYV9hbGdvcml0aG1cbiAqICAtIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVG9vbeKAk0Nvb2tfbXVsdGlwbGljYXRpb25cbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gciBiYXNlIChyYWRpeClcbiAqIEBwYXJhbSB7QXJyYXl9IGEgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHtOdW1iZXJ9IGFpIGEgbGVmdFxuICogQHBhcmFtIHtOdW1iZXJ9IGFqIGEgcmlnaHRcbiAqIEBwYXJhbSB7QXJyYXl9IGIgc2Vjb25kIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSBiaSBiIGxlZnRcbiAqIEBwYXJhbSB7TnVtYmVyfSBiaiBiIHJpZ2h0XG4gKiBAcGFyYW0ge0FycmF5fSBjIHJlc3VsdCwgbXVzdCBiZSAwIGluaXRpYWxpemVkXG4gKiBAcGFyYW0ge051bWJlcn0gY2kgYyBsZWZ0XG4gKiBAcGFyYW0ge051bWJlcn0gY2ogYyByaWdodFxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBfa2FyYXRzdWJhICggciAsIGEgLCBhaSAsIGFqICwgYiAsIGJpICwgYmogLCBjICwgY2kgLCBjaiApIHtcblxuXHRjb25zdCBpID0gYWogLSBhaSA7XG5cdGNvbnN0IGogPSBiaiAtIGJpIDtcblx0Y29uc3QgayA9IGNqIC0gY2kgO1xuXG5cdGNvbnN0IG4gID0gTWF0aC5jZWlsKCBpIC8gMiApIDtcblx0Y29uc3QgSSAgPSBpICsgaiA7XG5cdGNvbnN0IE4gID0gMiAqIG4gO1xuXHRjb25zdCBOXyA9IEkgLSBOIDtcblx0Y29uc3QgaV8gPSBhaiAtIG4gO1xuXHRjb25zdCBqXyA9IE1hdGgubWF4KCBiaSAsIGJqIC0gbiApIDtcblxuXHRjb25zdCB0MSA9IF96ZXJvcyggbiArIDEgKSA7IC8vICsgMSB0byBoYW5kbGUgYWRkaXRpb24gb3ZlcmZsb3dzXG5cdGNvbnN0IHQyID0gX3plcm9zKCBuICsgMSApIDsgLy8gYW5kIGd1YXJhbnRlZSByZWR1Y2luZyBrIGZvciB0aGVcblx0Y29uc3QgdDMgPSBfemVyb3MoIE4gKyAxICkgOyAvLyByZWN1cnNpdmUgY2FsbHNcblx0Y29uc3QgejIgPSBfemVyb3MoIE5fICkgO1xuXHRjb25zdCB6MCA9IF96ZXJvcyggTiApIDtcblxuXHQvLyBSRUNVUlNJVkUgQ0FMTFNcblx0X211bCggciAsIGEgLCBhaSAsIGlfICwgYiAsIGJpICwgal8gLCB6MiAsIDAgLCBOXyApIDsgICAgICAgICAgICAvLyB6MiA9IGExLmIxXG5cdF9tdWwoIHIgLCBhICwgaV8gLCBhaiAsIGIgLCBqXyAsIGJqICwgejAgLCAwICwgTiApIDsgICAgICAgICAgICAgLy8gejAgPSBhMC5iMFxuXHRfYWRkKCByICwgYSAsIGFpICwgaV8gLCBhICwgaV8gLCBhaiAsIHQxICwgMCAsIG4gKyAxICkgOyAgICAgICAgIC8vIChhMCArIGExKVxuXHRfYWRkKCByICwgYiAsIGJpICwgal8gLCBiICwgal8gLCBiaiAsIHQyICwgMCAsIG4gKyAxICkgOyAgICAgICAgIC8vIChiMSArIGIwKVxuXHRfbXVsKCByICwgdDEgLCAxICwgbiArIDEgLCB0MiAsIDEgLCBuICsgMSAsIHQzICwgMSAsIE4gKyAxICkgOyAgIC8vIChhMCArIGExKShiMSArIGIwKVxuXG5cdC8vIEJVSUxEIE9VVFBVVFxuXHRfY29weSggejIgLCAwICwgTl8gLCBjICwgY2ogLSBJICkgOyAvLyArIHoyIC4gcl57Mm59XG5cdF9jb3B5KCB6MCAsIDAgLCBOICAsIGMgLCBjaiAtIE4gKSA7IC8vICsgejBcblxuXHQvLyBvdmVyZmxvdyBvbiB0MSwgYWRkIHQyIC4gcl57bn1cblx0aWYgKCB0MVswXSApIF9pYWRkKCByICwgdDMgLCAwICwgbiArIDEgLCB0MiAsIDAgLCBuICsgMSApIDtcblxuXHQvLyBvdmVyZmxvdyBvbiB0MiwgYWRkIHQxIC4gcl57bn0gKGV4Y2VwdCB0MVswXSlcblx0aWYgKCB0MlswXSApIF9pYWRkKCByICwgdDMgLCAwICwgbiArIDEgLCB0MSAsIDEgLCBuICsgMSApIDtcblxuXHRfaWFkZCggciAsIGMgLCBjaSAsIGNqIC0gbiAsIHQzICwgMCAsIE4gKyAxICkgOyAvLyArIChhMCArIGExKShiMSArIGIwKSAuIHJee259XG5cdF9pc3ViKCByICwgYyAsIGNpICwgY2ogLSBuICwgejIgLCAwICwgTl8gKSA7ICAgIC8vIC0gejIgLiByXntufVxuXHRfaXN1YiggciAsIGMgLCBjaSAsIGNqIC0gbiAsIHowICwgMCAsIE4gKSA7ICAgICAvLyAtIHoxIC4gcl57bn1cblxufVxuIl19